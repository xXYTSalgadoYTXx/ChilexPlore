{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ChilExplore</title>

    <!-- fuente google -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet"/>
    <!-- boostrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- nouislider -->
    <link type="text/css" rel="stylesheet" href="{% static 'core/css/nouislider.min.css' %}"/>
    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="{% static 'core/css/font-awesome.min.css' %}"/>
    <!-- Custom stlylesheet -->
    <link type="text/css" rel="stylesheet" href="{% static 'core/css/style.css' %}"/>
  </head>
  <body>
    <!-- HEADER -->
    <header>
      {% if request.resolver_match.url_name != 'login' and request.resolver_match.url_name != 'registro' %}
        <nav class="navbar navbar-expand-lg navbar-light bg-dark" data-bs-theme="dark">
          <div class="container-fluid">
          
            <button type="button" class="btn btn-dark" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
              </svg>
            </button>

            <a class="navbar-brand mx-auto" href="#">ChilExplore</a>

            {% if user.is_authenticated and user.user_type == 'business' %}
                <a href="{% url 'mis_locales' %}" class="btn btn-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-shop" viewBox="0 0 16 16">
                        <path d="M2.97 1.35A1 1 0 0 1 3.73 1h8.54a1 1 0 0 1 .76.35l2.609 3.044A1.5 1.5 0 0 1 16 5.37v.255a2.375 2.375 0 0 1-4.25 1.458A2.37 2.37 0 0 1 9.875 8 2.37 2.37 0 0 1 8 7.083 2.37 2.37 0 0 1 6.125 8a2.37 2.37 0 0 1-1.875-.917A2.375 2.375 0 0 1 0 5.625V5.37a1.5 1.5 0 0 1 .361-.976zm1.78 4.275a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0 1.375 1.375 0 1 0 2.75 0V5.37a.5.5 0 0 0-.12-.325L12.27 2H3.73L1.12 5.045A.5.5 0 0 0 1 5.37v.255a1.375 1.375 0 0 0 2.75 0 .5.5 0 0 1 1 0M1.5 8.5A.5.5 0 0 1 2 9v6h1v-5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v5h6V9a.5.5 0 0 1 1 0v6h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1V9a.5.5 0 0 1 .5-.5M4 15h3v-5H4zm5-5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1zm3 0h-2v3h2z"/>
                    </svg>
                </a>
            {% endif %}

            <a href="{% url 'report_bug' %}" class="btn btn-dark">
              <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-bug" viewBox="0 0 16 16">
                <path d="M4.355.522a.5.5 0 0 1 .623.333l.291.956A5 5 0 0 1 8 1c1.007 0 1.946.298 2.731.811l.29-.956a.5.5 0 1 1 .957.29l-.41 1.352A5 5 0 0 1 13 6h.5a.5.5 0 0 0 .5-.5V5a.5.5 0 0 1 1 0v.5A1.5 1.5 0 0 1 13.5 7H13v1h1.5a.5.5 0 0 1 0 1H13v1h.5a1.5 1.5 0 0 1 1.5 1.5v.5a.5.5 0 1 1-1 0v-.5a.5.5 0 0 0-.5-.5H13a5 5 0 0 1-10 0h-.5a.5.5 0 0 0-.5.5v.5a.5.5 0 1 1-1 0v-.5A1.5 1.5 0 0 1 2.5 10H3V9H1.5a.5.5 0 0 1 0-1H3V7h-.5A1.5 1.5 0 0 1 1 5.5V5a.5.5 0 0 1 1 0v.5a.5.5 0 0 0 .5.5H3c0-1.364.547-2.601 1.432-3.503l-.41-1.352a.5.5 0 0 1 .333-.623M4 7v4a4 4 0 0 0 3.5 3.97V7zm4.5 0v7.97A4 4 0 0 0 12 11V7zM12 6a4 4 0 0 0-1.334-2.982A3.98 3.98 0 0 0 8 2a3.98 3.98 0 0 0-2.667 1.018A4 4 0 0 0 4 6z"/>
              </svg>
            </a>
          </div>

        </nav>
      {% endif %}

    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Menú</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body gap-2">
        <ul class="menu">
          <li><a class="btn" href="{% url 'mapa_locales' %}">Mapa</a></li>
          {% if user.is_authenticated and user.user_type == 'business' %}
          <li><a class="btn" href="{% url 'mis_locales' %}">Mis Locales</a></li>
          {% endif %}
          <li><hr class="divider"></li>
          <li><a class="btn" href="{% url 'perfil' %}">Perfil</a></li>
          <li><a class="btn" href="{% url 'ver_favoritos' %}">Favoritos</a>
            </li>
        </ul>
      </div>
      <div class="offcanvas-buttom mb-3 me-3">
        <form action="{% url 'logout' %}" method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger float-end">
            Cerrar Sesión
          </button>
        </form>
      </div>
    </div>

    {% block principal %} {% endblock %}

    <!-- Plugins -->
    <script src="{% static 'core/js/jquery.min.js' %}"></script>
    <script src="{% static 'core/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'core/js/slick.min.js' %}"></script>
    <script src="{% static 'core/js/nouislider.min.js' %}"></script>
    <script src="{% static 'core/js/jquery.zoom.min.js' %}"></script>
    <script src="{% static 'core/js/main.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.toggle-favorito').forEach(button => {
            button.addEventListener('click', () => {
                const localId = button.dataset.id;
                if (!localId) {
                    console.error("No se ha encontrado el ID del local");
                    return;
                }

                fetch(`/toggle_favorito/${localId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.is_favorito) {
                        button.textContent = 'Quitar de Favoritos';
                        button.classList.remove('btn-outline-primary');
                        button.classList.add('btn-outline-danger');
                    } else {
                        button.textContent = 'Agregar a Favoritos';
                        button.classList.remove('btn-outline-danger');
                        button.classList.add('btn-outline-primary');
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    });
    </script>  
  </body>
</html>
